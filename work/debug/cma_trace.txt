
1.make menuconfig 选择kernel_hacking中的tracing:


mount  -t  debugfs  nodev  /sys/kernel/debug

2. 跟踪中断：
echo 0 > tracing_on
echo irqsoff > current_tracer
echo 1 > tracing_on
.....
cat trace

3. 跟踪线程
echo 1211 > /sys/kernel/debug/tracing/set_ftrace_pid       //pid
echo function > /sys/kernel/debug/tracing/current_tracer 
 
4.跟踪函数：
echo nop > /sys/kernel/debug/tracing/current_tracer
echo 0 > /sys/kernel/debug/tracing/tracing_on
echo function_graph > /sys/kernel/debug/tracing/current_tracer
echo cma_alloc > /sys/kernel/debug/tracing/set_graph_function
echo alloc_contig_range >> /sys/kernel/debug/tracing/set_graph_function
echo 1 > /sys/kernel/debug/tracing/tracing_on

echo dma_alloc_coherent >> /sys/kernel/debug/tracing/set_graph_function  
echo dma_alloc_attrs >> /sys/kernel/debug/tracing/set_graph_function 
echo __dma_alloc_from_coherent >> /sys/kernel/debug/tracing/set_graph_function



解析：
vim -S function-graph-fold.vim 1.txt

看spi-sync失败原因

echo nop > /sys/kernel/debug/tracing/current_tracer
echo 0 > /sys/kernel/debug/tracing/tracing_on
echo function_graph > /sys/kernel/debug/tracing/current_tracer
echo spi_sync > /sys/kernel/debug/tracing/set_graph_function
echo 1 > /sys/kernel/debug/tracing/tracing_on

抓取函数：
cat /sys/kernel/debug/tracing/trace > 1.txt


看vfs_read

echo nop > /sys/kernel/debug/tracing/current_tracer
echo 0 > /sys/kernel/debug/tracing/tracing_on
echo function_graph > /sys/kernel/debug/tracing/current_tracer
echo `fac_ioctl` > $debugfs/tracing/set_ftrace_pid
echo vfs_read > /sys/kernel/debug/tracing/set_graph_function
echo 1 > /sys/kernel/debug/tracing/tracing_on